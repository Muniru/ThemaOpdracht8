---
title: "Week_Opdracht3"
author: "Muniru & Sam"
date: '2022-05-16'
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Week Opdracht 3

```{r input data}
library(deSolve)
library(ggplot2)

data <- read.csv("data/MPL.csv", na.strings = "NA")
median_MPL_01 <- median(data$MPL_conc[data$dose==0.1], na.rm=T)
median_MPL_03 <- median(data$MPL_conc[data$dose==0.3], na.rm=T)


# Define the parameters
volume_D <- median_MPL_03
nmol <- volume_D * 1000 * (1 / 374.477) 
parameters <- c(Kd_Rm = 0.612, Kre = 0.57, Ks_Rm = 2.90, IC50_Rm = 26.2, 
                Kd_R = 0.0572, Rf = 0.49, Kon= 0.00329,
                Kt = 0.63, D=nmol, Ks_r = 3.22)

# The model we will use
model <- function(t, y, parms){
  with(as.list(c(y, parms)),{
    # Concentratie Receptor mRNA
    dmRNA.R_dt <- Ks_Rm * (1 - (DRN/(IC50_Rm+DRN))) - Kd_Rm * mRNA.R
    
    # Het basisniveau van de concentratie vrije receptor
    dR_dt <- Ks_r* mRNA.R + Rf * Kre * DRN - Kon * D * R - Kd_R * R
    
    # De dichtheid van het MPL-receptor complex
    dDR_dt <- Kon * D * R - Kt * DR
    
    # De hoeveelheid MPL-receptor complex in de celkern
    dDRN_dt <- Kt * DR - Kre * DRN
    
    return(list(c(dmRNA.R_dt, dR_dt, dDR_dt, dDRN_dt)))
    })
}

# Initial values
state <- c(mRNA.R = 4.74,
           R = 267,
           DR = 0,
           DRN = 0)

times <- seq(0,
             168,
             by = 1)

# Using the model with our parameters and initial values
out  <- ode(times = times,
            y = state,
            parms = parameters,
            func = model, 
            method = "euler")
out1 <- data.frame(out)

volume_D <- median_MPL_01
nmol <- volume_D * 1000 * (1 / 374.477) 
parameters <- c(Kd_Rm = 0.612, Kre = 0.57, Ks_Rm = 2.90, IC50_Rm = 26.2, 
                Kd_R = 0.0572, Rf = 0.49, Kon= 0.00329,
                Kt = 0.63, D=nmol, Ks_r = 3.22)

# Using the model with our parameters and initial values
out  <- ode(times = times,
            y = state,
            parms = parameters,
            func = model, 
            method = "euler")
out <- data.frame(out)
plot(out1$mRNA.R)
lines(out$mRNA.R, col="red")

medians <- aggregate(data[,c("MPL_conc","mRNA","Free_receptor")],list(data$dose,data$time), median, na.rm=T)
names(medians)[1:2] <- c("dose","time")

md <- aggregate(data$mRNA,list(data$time), median, na.rm=T)

names(md)[1:2] <- c("time", "median")

ggplot() + geom_point(data, mapping=aes(x=time, y=mRNA)) + geom_line(out, mapping=aes(x=time, y=mRNA.R)) + geom_line(md, mapping = aes(x=time, y=median))
  
```
[1] Why is it best practice to plot the median for the experimental data? Explain in your report

    In experimentele data kunnen snel uitschieters voorkomen. Als je het 
    gemmiddelde zal pakken dan wil zal dit verder uitwijken. daarom is het meer 
    betrouwbaar om het mediaan te pakken.
[2] How do the results of the simulations depend on the dose and concentration of the drug? Compare the
model variables mRNA, R with the experimental data by running the simulations adjusting dosis D and plot these to find the answer.

    Wanneer de dosis hogere(0.3) is wordt de mrna transcriptie meer geremd dan 
    met een lagere dosis. Het aantal vrije receptoren neemt sneller af met een 
    hogere dosis.
[3] Are the results of the model in line with experimental data? If not, what could be the reason? Think of at least one explanation. Try to test it with simulations (you will get bonus points for that, your explanation does not need to be correct, but should be logical).
    
    
    Ja, Dat is te herleiden uit het figuur. Daar is te zien dat de waarden 
    gegroepeerd dalen via dezelfde tijdseenheid als bij het model. 
    